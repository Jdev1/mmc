# g++ -g -o HowToUse_Dll HowToUse_Dll.cpp -ldl -lpthread

include vars.mk

CC=gcc
CXX=g++
PYTHON=python
CFLAGS=-g -Wall -O0 -Iinclude
CXXFLAGS=-g -Wall -O0 -Iinclude
LDFLAGS=-ldl -lpthread
LDFLAGS_CYTHON=-L.
MKDIR=mkdir
RM=rm
RMFLAGS=-rf

all: $(BIN_FRAGMENT_CLASSIFIER_SKEL) $(BIN_FRAGMENT_CLASSIFIER_NCD) $(BIN_FRAGMENT_CLASSIFIER) $(BIN_DATA_SNIFFER) $(BIN_TEST_NCD)

$(BIN_FRAGMENT_CLASSIFIER_SKEL): init $(OBJ_FRAGMENT_CLASSIFIER_SKEL)
	$(CC) -o $(BIN_FRAGMENT_CLASSIFIER_SKEL) $(OBJ_FRAGMENT_CLASSIFIER_SKEL) $(LDFLAGS_FRAGMENT_CLASSIFIER_SKEL) $(LDFLAGS) 

$(BIN_FRAGMENT_CLASSIFIER_NCD): init $(OBJ_FRAGMENT_CLASSIFIER_NCD)
	$(CC) -o $(BIN_FRAGMENT_CLASSIFIER_NCD) $(OBJ_FRAGMENT_CLASSIFIER_NCD) $(LDFLAGS_FRAGMENT_CLASSIFIER_NCD) $(LDFLAGS) 

$(BIN_FRAGMENT_CLASSIFIER): init $(BIN_FRAGMENT_CLASSIFIER_SKEL) $(BIN_FRAGMENT_CLASSIFIER_NCD) $(OBJ_FRAGMENT_CLASSIFIER)
	$(CC) -o $(BIN_FRAGMENT_CLASSIFIER) $(OBJ_FRAGMENT_CLASSIFIER) $(LDFLAGS_FRAGMENT_CLASSIFIER) $(LDFLAGS) 

$(BIN_DATA_SNIFFER): init $(OBJ_DATA_SNIFFER) $(BIN_FRAGMENT_CLASSIFIER)
	$(CC) -o $(BIN_DATA_SNIFFER) $(OBJ_DATA_SNIFFER) $(LDFLAGS) $(LDFLAGS_DATA_SNIFFER)

$(BIN_TEST_NCD): init $(OBJ_TEST_NCD)
	$(CC) -o $(BIN_TEST_NCD) $(OBJ_TEST_NCD) $(LDFLAGS) $(LDFLAGS_TEST_NCD)

$(BUILD_DIR_SKEL)/%.o: $(SRC_DIR_SKEL)/%.c
	$(CC) -c $(CFLAGS_FRAGMENT_CLASSIFIER_SKEL) -o $@ $<

$(BUILD_DIR_NCD)/%.o: $(SRC_DIR_NCD)/%.c
	$(CC) -c $(CFLAGS_FRAGMENT_CLASSIFIER_NCD) -o $@ $<

$(BUILD_DIR)/%.o: $(SRC_DIR)/%.c
	$(CC) -c $(CFLAGS) $(CFLAGS_FRAGMENT_CLASSIFIER) -o $@ $<

init:
	@if [ ! -d $(BUILD_DIR) ] ; then $(MKDIR) -p $(BUILD_DIR) ; fi
	@if [ ! -d $(BUILD_DIR_NCD) ] ; then $(MKDIR) -p $(BUILD_DIR_NCD) ; fi
	@if [ ! -d $(BUILD_DIR_SKEL) ] ; then $(MKDIR) -p $(BUILD_DIR_SKEL) ; fi
	@if [ ! -d $(OUT_DIR) ] ; then $(MKDIR) -p $(OUT_DIR) ; fi

clean:
	$(RM) $(RMFLAGS) $(BUILD_DIR_SKEL)
	$(RM) $(RMFLAGS) $(BUILD_DIR_NCD)
	$(RM) $(RMFLAGS) $(BUILD_DIR)
	$(RM) $(RMFLAGS) $(BIN_FRAGMENT_CLASSIFIER_SKEL)
	$(RM) $(RMFLAGS) $(BIN_FRAGMENT_CLASSIFIER_NCD)
	$(RM) $(RMFLAGS) $(BIN_FRAGMENT_CLASSIFIER)
	$(RM) $(RMFLAGS) $(BIN_DATA_SNIFFER)
	$(RM) $(RMFLAGS) $(BIN_TEST_NCD)

